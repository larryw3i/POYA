@model POYA.Areas.WeEduHub.Models.WeArticle

@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    var IsEdit=Convert.ToBoolean(ViewData["IsEdit"]??false);
    
    ViewData["Title"] =IsEdit?Localizer["Edit"]:Localizer[ "Create"];

    var FirstClassId=IsEdit?ViewData["FirstClassId"].ToString():string.Empty;
}


<h4 >@(Localizer["Your articles and videos"])</h4>

<hr />
<div class="row">
    <div class="offset-sm-1 col-sm-10 offset-2 col-8 ">
        <form asp-action='@(IsEdit?"Edit":"Create")' enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input asp-for="SetId" type="hidden"/>            
            <input type="file" asp-for="WeArticleFormFile" hidden accept=".pdf"/>
            <input asp-for="ClassId" type="hidden"/>
            <input asp-for="CustomClass" type="hidden"/>
            <input asp-for="Complex" type="hidden"/>

            <div class="form-group">
                <input asp-for="Title" class="form-control" placeholder='@(Localizer["Title"])' autocomplete="off"> 
                <span asp-validation-for="Title" class="text-danger"></span>
            </div>
            <div class="form-group operation-form-group">
                <a id="go_back" class="btn btn-info">&laquo; @(Localizer["Back"])</a>   
                <a class="btn btn-info" id="select-file">@(Localizer["Select file"])</a>   
                <input type="submit" value='@(Localizer["Upgrade"])' class="btn btn-primary" />  
            </div>
        </form> 

    </div>
</div>

<div class="selected_file_content_parent">
    <object id="selected_file_content" data='@(IsEdit?Url.Action("GetWeArticleFile",new{Id=Model.WeArticleFileId,area="WeEduHub"}):"")' type="application/pdf" width="100%" height="100%"></object>  
</div>

<div class="col offset-sm-1 col-sm-10 offset-2 col-8" >
    <div id="wearticle_class_and_" class="row">
        <div class="col col-auto">
            <select id="first_class_select"  class="form-control" >
            </select>
        </div>
        <div class="col col-auto">
            <select id="second_class_select"  class="form-control" > 
            </select> 
        </div>
        <div class="col col-auto">
            <input  id="custom_class_input" class="form-control" value="@(Model.CustomClass)" placeholder='@(Localizer["Custom classification"])'/>
        </div>
        <div class="col col-auto">
            <select  id="complex_select" asp-items="@(Model.ComplexSelectListItems)" class="form-control"></select>
        </div>
    </div>
</div>


@section Scripts 
{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(()=>{
            $(document).on(`click`,`#select-file`,()=>{ SelectFileClick(); });

            $(document).on(`change`,`#WeArticleFormFile`,(e)=>{  WeArticleFormFileChange(e); })
            
            $(document).on(`change`,`#first_class_select`,(e)=>{ FirstClassSelectChange(e); })

            $(document).on(`change`,`#second_class_select`,(e)=>{ SecondClassSelectChange(e); })

            $(document).on(`input propertychange`,`#custom_class_input`,(e)=>{ CustomClassInputPropertyChange(e); })

            $(document).on(`change`,`#complex_select`,(e)=>{ ComplexSelectChange(e);  });
            
            if(Boolean(`@(IsEdit?" ":"")`)) $(`#complex_select`).find(`option[value='@(Model.Complex)']`).attr("selected",true);

            InitialWeArticleFirstClasses();

        });

        function ComplexSelectChange(e) {   $(`#Complex`).val( $(`#complex_select`).val() );     }

        function CustomClassInputPropertyChange(e) {  $(`#CustomClass`).val($(`#custom_class_input`).val());    }

        function SecondClassSelectChange(e) { $(`#ClassId`).val($(e.target).val());  }

        function FirstClassSelectChange(e)
        {
            $(`#second_class_select`).load(`@(Url.Action("GetSecondClassesByFirstClassCode"))?FirstClassCode=`+$(e.target).find("option:selected").attr(`itemcode`));
        }

        function InitialWeArticleFirstClasses()
        {
            $.get(`@(Url.Action("GetAllFirstClasses"))`,(data)=>{ 
                $(`#first_class_select`).html(data);
                
                if(Boolean(`@(IsEdit?" ":"")`))
                {
                    $(`#first_class_select`).find(`option[value='@(FirstClassId)']`).attr("selected",true);
                    $.get(
                        `@(Url.Action("GetSecondClassesByFirstClassCode"))?FirstClassCode=`+$(`#first_class_select option[value='@(FirstClassId)']`).attr(`itemcode`),
                        (data)=>{
                            $(`#second_class_select`).html(data);
                            $(`#second_class_select`).find(`option[value='@(Model.ClassId)']`).attr("selected",true);
                        }
                    );
                }
                else{
                    $(`#second_class_select`).load(`@(Url.Action("GetSecondClassesByFirstClassCode"))?FirstClassCode=`+$(`#first_class_select option:first`).attr(`itemcode`));
                }
            });
        }

        function WeArticleFormFileChange(e)
        {
            var _file=document.getElementById(`WeArticleFormFile`).files[0];
            

            if(!String(_file.name).endsWith(`.pdf`)) return;
        
            var _reader = new FileReader();

            _reader.readAsDataURL(_file);
            
            _reader.onload = function(){   
                $(`#selected_file_content`).attr("data",this.result);
            }
            
        }

        function SelectFileClick()  {  $(`#WeArticleFormFile`).click();   }
        
    </script>
}


@section Styles
{
    <style>
        #GoToTop{
            display: none;
        }
        .selected_file_content_parent{
            width:100%;
            height: 70%;
            padding: 8px;
            border: solid;
            border-color: rgba(89, 99, 34, 0.4);
            border-radius: 8px;
            overflow-x: auto;
            overflow-y: auto;
            zoom: 0.8;
        }
        #wearticle_class_and_{
            margin-bottom: 60px;
            margin-top: 10px;
            border: solid;
            border-color: rgba(89, 99, 200, 0.4);
            border-radius: 10px;
            text-align: center;
            padding:10px;
        }
        #Title{
            text-align: center;    
        }
        
        .operation-form-group{
            position: fixed;
            bottom: 50px;
            z-index: 99;
        }

        .operation-form-group .btn{
            margin: 8px;
        }
    </style>
}